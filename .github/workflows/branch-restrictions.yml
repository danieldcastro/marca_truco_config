name: Restrict Branch Names

on:
  create:

jobs:
  check-branch-name:
    runs-on: ubuntu-latest
    steps:
    - name: Check branch name
      run: |
        BRANCH_NAME="${{ github.ref_name }}"
        if [[ ! "$BRANCH_NAME" =~ ^(feat/|fix/|chore/|ref/|docs/|revert/|build/|ci/|test/) ]]; then
          echo "‚ùå Branch name '$BRANCH_NAME' is not allowed!"
          echo "Allowed branch name prefixes are: feat/, fix/, chore/, ref/, docs/, revert/, build/, ci/, test/"
    
          # Excluir a branch inv√°lida e capturar o c√≥digo de resposta
          echo "üóëÔ∏è Deleting invalid branch..."
          RESPONSE=$(curl -s -o response.json -w "%{http_code}" -X DELETE \
            -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/${{ github.repository }}/git/refs/heads/$BRANCH_NAME")

          # Exibir resposta da API para debug
          echo "GitHub API response: $RESPONSE"
          cat response.json
    
          # Se a exclus√£o for bem-sucedida (204), saia com sucesso
          if [[ "$RESPONSE" == "204" ]]; then
            echo "‚úÖ Branch '$BRANCH_NAME' deleted successfully!"
            exit 0
          else
            echo "‚ö†Ô∏è Failed to delete branch. Check response above."
            exit 1
          fi
        fi

